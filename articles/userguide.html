<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R client for an ArtifactDB API • zircon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R client for an ArtifactDB API">
<meta property="og:description" content="zircon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zircon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.98.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/userguide.html">R client for an ArtifactDB API</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R client for an ArtifactDB API</h1>
                        <h4 data-toc-skip class="author">Aaron Lun</h4>
                  <a class="author_email" href="mailto:#"></a><a href="mailto:infinite.monkeys.with.keyboards@gmail.com" class="email">infinite.monkeys.with.keyboards@gmail.com</a>
      
                  
            <h4 data-toc-skip class="date">Revised: September 29,
2022</h4>
      
      
      <div class="hidden name"><code>userguide.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em><a href="https://github.com/ArtifactDB/zircon-R" class="external-link">zircon</a></em>
implements a simple R client for interacting with an ArtifactDB REST
API. It provides functions to download/upload files and metadata given
the API’s URL. Developers can also inject authentication and caching
mechanisms to build application-specific interfaces on top of <em><a href="https://github.com/ArtifactDB/zircon-R" class="external-link">zircon</a></em>.</p>
<p>In this vignette, we’ll be demonstrating the functionality of <em><a href="https://github.com/ArtifactDB/zircon-R" class="external-link">zircon</a></em> using our
test ArtifactDB URL and a sample identifier.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">zircon</span><span class="op">)</span></span>
<span><span class="va">example.url</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "https://gypsum-test.aaron-lun.workers.dev"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example.id</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "test-zircon-upload:blah.txt@base"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="identifier-structure">Identifier structure<a class="anchor" aria-label="anchor" href="#identifier-structure"></a>
</h2>
<p>The “ArtifactDB identifier” for a file takes the form of
<code>&lt;PROJECT&gt;:&lt;PATH&gt;@&lt;VERSION&gt;</code>.</p>
<ul>
<li>
<code>PROJECT</code> defines the name of the project.</li>
<li>
<code>PATH</code> defines a path to a file within the project,
possibly in a subdirectory.</li>
<li>
<code>VERSION</code> defines the version of the project.</li>
</ul>
<p>We can process IDs using the <code>unpackID</code> and
<code>packID</code> utilities.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unpacked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unpackID.html">unpackID</a></span><span class="op">(</span><span class="va">example.id</span><span class="op">)</span></span>
<span><span class="va">unpacked</span></span></code></pre></div>
<pre><code><span><span class="co">## $project</span></span>
<span><span class="co">## [1] "test-zircon-upload"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $path</span></span>
<span><span class="co">## [1] "blah.txt"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $version</span></span>
<span><span class="co">## [1] "base"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">packID</span>, <span class="va">unpacked</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "test-zircon-upload:blah.txt@base"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="getting-files-and-their-metadata">Getting files and their metadata<a class="anchor" aria-label="anchor" href="#getting-files-and-their-metadata"></a>
</h2>
<p>The <code><a href="../reference/getFile.html">getFile()</a></code> function does as it says, downloading the
file from the API. Note that this uses <code><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file()</a></code> so
setting <code>options(timeout=...)</code> may be required for larger
files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getFile.html">getFile</a></span><span class="op">(</span><span class="va">example.id</span>, url<span class="op">=</span><span class="va">example.url</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q" "R" "S"</span></span>
<span><span class="co">## [20] "T" "U" "V" "W" "X" "Y" "Z"</span></span></code></pre>
<p>Similarly, <code><a href="../reference/getFileMetadata.html">getFileMetadata()</a></code> retrieves the file’s
metadata.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getFileMetadata.html">getFileMetadata</a></span><span class="op">(</span><span class="va">example.id</span>, url<span class="op">=</span><span class="va">example.url</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 5</span></span>
<span><span class="co">##  $ $schema     : chr "generic_file/v1.json"</span></span>
<span><span class="co">##  $ generic_file:List of 1</span></span>
<span><span class="co">##   ..$ format: chr "text"</span></span>
<span><span class="co">##  $ md5sum      : chr "0eb827652a5c272e1c82002f1c972018"</span></span>
<span><span class="co">##  $ path        : chr "blah.txt"</span></span>
<span><span class="co">##  $ _extra      :List of 9</span></span>
<span><span class="co">##   ..$ $schema      : chr "generic_file/v1.json"</span></span>
<span><span class="co">##   ..$ id           : chr "test-zircon-upload:blah.txt@base"</span></span>
<span><span class="co">##   ..$ project_id   : chr "test-zircon-upload"</span></span>
<span><span class="co">##   ..$ version      : chr "base"</span></span>
<span><span class="co">##   ..$ metapath     : chr "blah.txt"</span></span>
<span><span class="co">##   ..$ meta_indexed : chr "2022-10-01T19:45:51.913Z"</span></span>
<span><span class="co">##   ..$ meta_uploaded: chr "2022-10-01T19:45:34.442Z"</span></span>
<span><span class="co">##   ..$ uploaded     : chr "2022-10-01T19:45:34.442Z"</span></span>
<span><span class="co">##   ..$ permissions  :List of 5</span></span>
<span><span class="co">##   .. ..$ scope       : chr "project"</span></span>
<span><span class="co">##   .. ..$ read_access : chr "public"</span></span>
<span><span class="co">##   .. ..$ write_access: chr "owners"</span></span>
<span><span class="co">##   .. ..$ owners      : chr "ArtifactDB-bot"</span></span>
<span><span class="co">##   .. ..$ viewers     : list()</span></span></code></pre>
<p>Similarly, we can retrieve the metadata for all files in a given
project:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getProjectMetadata.html">getProjectMetadata</a></span><span class="op">(</span><span class="va">example.project</span>, url<span class="op">=</span><span class="va">example.url</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">proj</span><span class="op">)</span> <span class="co"># number of files</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 36</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="resolving-the-latest-version">Resolving the latest version<a class="anchor" aria-label="anchor" href="#resolving-the-latest-version"></a>
</h2>
<p>ArtifactDB APIs recognize the <code>"latest"</code> version alias,
which will automatically redirect to the latest version of the
project.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unpackID.html">packID</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">unpacked</span><span class="op">$</span><span class="va">path</span>, <span class="st">"latest"</span><span class="op">)</span></span>
<span><span class="va">meta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getFileMetadata.html">getFileMetadata</a></span><span class="op">(</span><span class="va">id2</span>, url<span class="op">=</span><span class="va">example.url</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta2</span><span class="op">)</span> <span class="co"># May or may not be the same as 'meta', depending on available versions.</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 5</span></span>
<span><span class="co">##  $ $schema     : chr "generic_file/v1.json"</span></span>
<span><span class="co">##  $ generic_file:List of 1</span></span>
<span><span class="co">##   ..$ format: chr "text"</span></span>
<span><span class="co">##  $ md5sum      : chr "0eb827652a5c272e1c82002f1c972018"</span></span>
<span><span class="co">##  $ path        : chr "blah.txt"</span></span>
<span><span class="co">##  $ _extra      :List of 11</span></span>
<span><span class="co">##   ..$ $schema      : chr "generic_file/v1.json"</span></span>
<span><span class="co">##   ..$ id           : chr "test-zircon-upload:blah.txt@1665096278"</span></span>
<span><span class="co">##   ..$ project_id   : chr "test-zircon-upload"</span></span>
<span><span class="co">##   ..$ version      : chr "1665096278"</span></span>
<span><span class="co">##   ..$ metapath     : chr "blah.txt"</span></span>
<span><span class="co">##   ..$ meta_indexed : chr "2022-10-06T22:45:01.922Z"</span></span>
<span><span class="co">##   ..$ meta_uploaded: chr "2022-10-06T22:44:40.212Z"</span></span>
<span><span class="co">##   ..$ uploaded     : chr "2022-10-06T22:44:40.212Z"</span></span>
<span><span class="co">##   ..$ permissions  :List of 5</span></span>
<span><span class="co">##   .. ..$ scope       : chr "project"</span></span>
<span><span class="co">##   .. ..$ read_access : chr "public"</span></span>
<span><span class="co">##   .. ..$ write_access: chr "owners"</span></span>
<span><span class="co">##   .. ..$ owners      : chr "ArtifactDB-bot"</span></span>
<span><span class="co">##   .. ..$ viewers     : list()</span></span>
<span><span class="co">##   ..$ transient    :List of 2</span></span>
<span><span class="co">##   .. ..$ expires_in    : chr "2022-10-07T22:45:01.922Z"</span></span>
<span><span class="co">##   .. ..$ expires_job_id: int 283</span></span>
<span><span class="co">##   ..$ link         :List of 1</span></span>
<span><span class="co">##   .. ..$ artifactdb: chr "test-zircon-upload:blah.txt@base"</span></span></code></pre>
<p>While convenient for users, this is not amenable to reproducibility
as the redirection can change upon creation of a new version of the
project. Developers may wish to resolve the <code>"latest"</code> alias
to ensure that the actual version is recorded in their applications.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/resolveLatestVersion.html">resolveLatestID</a></span><span class="op">(</span><span class="va">id2</span>, <span class="va">example.url</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "test-zircon-upload:blah.txt@1665096278"</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/resolveLatestVersion.html">resolveLatestVersion</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">example.url</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1665096278"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="checking-permissions">Checking permissions<a class="anchor" aria-label="anchor" href="#checking-permissions"></a>
</h2>
<p>To see the permissions on a project:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPermissions.html">getPermissions</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">example.url</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $scope</span></span>
<span><span class="co">## [1] "project"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $read_access</span></span>
<span><span class="co">## [1] "public"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $write_access</span></span>
<span><span class="co">## [1] "owners"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $owners</span></span>
<span><span class="co">## [1] "ArtifactDB-bot"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $viewers</span></span>
<span><span class="co">## character(0)</span></span></code></pre>
<p>Project owners may change the permissions with
<code><a href="../reference/getPermissions.html">setPermissions()</a></code>, e.g.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set to private:</span></span>
<span><span class="fu"><a href="../reference/getPermissions.html">setPermissions</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">example.url</span>, public<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add viewers:</span></span>
<span><span class="fu"><a href="../reference/getPermissions.html">setPermissions</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">example.url</span>, viewers<span class="op">=</span><span class="st">"LTLA"</span>, action<span class="op">=</span><span class="st">"append"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove viewers:</span></span>
<span><span class="fu"><a href="../reference/getPermissions.html">setPermissions</a></span><span class="op">(</span><span class="va">unpacked</span><span class="op">$</span><span class="va">project</span>, <span class="va">example.url</span>, viewers<span class="op">=</span><span class="st">"LTLA"</span>, action<span class="op">=</span><span class="st">"remove"</span><span class="op">)</span></span></code></pre></div>
<p>The test API uses GitHub user names and tokens for authentication,
though other deployments may use different mechanisms.</p>
</div>
<div class="section level2">
<h2 id="uploading-new-projects">Uploading new projects<a class="anchor" aria-label="anchor" href="#uploading-new-projects"></a>
</h2>
<p>With appropriate authorization, users can upload their own projects
to an ArtifactDB API. This assumes that file artifacts have been
generated with the appropriate JSON metadata. Check out <a href="https://github.com/ArtifactDB/BiocObjectSchemas" class="external-link"><code>ArtifactDB/BiocObjectSchemas</code></a>
for examples of file/metadata uploads that are recognized by the test
API; of course, an API maintainer may choose to use other schemas, so
users should be aware of the target API.</p>
<p>The upload process assumes that all to-be-uploaded files are
available within a “staging” directory. This directory corresponds to a
single version of the project; the <code>PATH</code> in the ArtifactDB
identifier for each file is defined relative to the root of this
directory. Given the directory path, the simplest upload code will look
like:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not evaluated as this vignette builder is not appropriately authorized.</span></span>
<span><span class="fu"><a href="../reference/uploadProject.html">uploadProject</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">example.url</span>, project<span class="op">=</span><span class="st">"test-zircon-upload"</span>, version<span class="op">=</span><span class="st">"foo"</span><span class="op">)</span></span></code></pre></div>
<p>For finer control of the upload process, developers may prefer the
following sequence of commands:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not evaluated.</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">start.url</span> <span class="op">&lt;-</span> <span class="fu">createUploadStartUrl</span><span class="op">(</span><span class="va">example.url</span>, <span class="st">"test-zircon-upload"</span>, <span class="st">"bar"</span><span class="op">)</span></span>
<span><span class="va">info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/upload-utils.html">initializeUpload</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">f</span>, <span class="va">start.url</span><span class="op">)</span></span>
<span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html" class="external-link">content</a></span><span class="op">(</span><span class="va">info</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/upload-utils.html">uploadFiles</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">example.url</span>, <span class="va">parsed</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/upload-utils.html">completeUpload</a></span><span class="op">(</span><span class="va">example.url</span>, <span class="va">parsed</span><span class="op">)</span></span></code></pre></div>
<p>Some of the more interesting upload options include:</p>
<ul>
<li>
<code>expires</code>: specify an expiry date for uploaded project
versions, after which they will be automatically deleted from storage.
This is useful for testing with dummy projects.</li>
<li>
<code>dedup.md5</code>: hint to the ArtifactDB backend that some
files might be redundant with their counterparts in a previous version
of the project. If they have the same path and MDF5 checksum, the
backend will create a link in the new version rather than requiring a
fresh upload.</li>
<li>
<code>dedup.link</code>: instruct the ArtifactDB backend that a file
is the same as another file that is already in storage (possibly from a
different project). The backend will then create a link in the current
project.</li>
<li>
<code>permissions</code>: set the permissions for the project, for
new projects with no previous versions (unless
<code>overwrite.permissions=TRUE</code>).</li>
</ul>
</div>
<div class="section level2">
<h2 id="caching-api-responses">Caching API responses<a class="anchor" aria-label="anchor" href="#caching-api-responses"></a>
</h2>
<p>Some of the getter functions can perform caching by providing an
appropriate function to <code>cache=</code>. This function should check
if the key already exists in the cache - if it does, the path in the
cached file can be used directly, otherwise it should be downloaded from
the API.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp.cache</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"zircon-cache"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tmp.cache</span><span class="op">)</span></span>
<span><span class="va">cache.fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">key</span>, <span class="va">save</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmp.cache</span>, <span class="fu"><a href="https://rdrr.io/r/utils/URLencode.html" class="external-link">URLencode</a></span><span class="op">(</span><span class="va">key</span>, reserved<span class="op">=</span><span class="cn">TRUE</span>, repeated<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"cache hit!\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">path</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/getFile.html">getFile</a></span><span class="op">(</span><span class="va">example.id</span>, <span class="va">example.url</span>, cache <span class="op">=</span> <span class="va">cache.fun</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/tmp/RtmpFg0Xcp/zircon-cache/https%3A%2F%2Fgypsum-test.aaron-lun.workers.dev%2Ffiles%2Ftest-zircon-upload%253Ablah.txt%2540base"</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cache hit (for the file and its metadata), same file path reported:</span></span>
<span><span class="fu"><a href="../reference/getFile.html">getFile</a></span><span class="op">(</span><span class="va">example.id</span>, <span class="va">example.url</span>, cache <span class="op">=</span> <span class="va">cache.fun</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## cache hit!</span></span>
<span><span class="co">## cache hit!</span></span></code></pre>
<pre><code><span><span class="co">## [1] "/tmp/RtmpFg0Xcp/zircon-cache/https%3A%2F%2Fgypsum-test.aaron-lun.workers.dev%2Ffiles%2Ftest-zircon-upload%253Ablah.txt%2540base"</span></span></code></pre>
<p>Note that this mechanism will automatically resolve any
<code>latest</code> aliases in the supplied identifiers. This avoids
problems with stale caches after updating the project versions.</p>
<p>Application developers are strongly advised to use some kind of
caching to reduce bandwidth and data egress costs.</p>
</div>
<div class="section level2">
<h2 id="customizing-the-authentication">Customizing the authentication<a class="anchor" aria-label="anchor" href="#customizing-the-authentication"></a>
</h2>
<p>Developers can globally specify the authentication procedure by
through the <code><a href="../reference/authorizedVerb.html">identityAvailable()</a></code> and
<code><a href="../reference/authorizedVerb.html">identityHeaders()</a></code> functions. To demonstrate, we’ll be using
GitHub personal access tokens:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.fetch_token_from_cache</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">exists.only</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">R_user_dir</a></span><span class="op">(</span><span class="st">"my_app_name"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Storing token in plaintext, which is probably fine. If you want it to be</span></span>
<span>    <span class="co"># more secure, that's up to you.</span></span>
<span>    <span class="va">token.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"token.txt"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">token.path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">exists.only</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="co"># A more advanced approach might also double-check that the cached</span></span>
<span>            <span class="co"># token is still valid before returning it.</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">token.path</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">exists.only</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="va">msg</span> <span class="op">&lt;-</span> <span class="st">"Generate a GitHub personal access token at https://github.com/settings/tokens"</span></span>
<span>    <span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html" class="external-link">readline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">msg</span>, <span class="st">"\nTOKEN: "</span><span class="op">)</span><span class="op">)</span> <span class="co"># Use something like getPass for masking.</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>con<span class="op">=</span><span class="va">token.path</span>, <span class="va">token</span><span class="op">)</span></span>
<span>    <span class="va">token</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We first set the <code><a href="../reference/authorizedVerb.html">identityAvailable()</a></code> function, which
indicates whether any identification information is available. This is
used to check whether an initial API request should be attempted without
any authentication, e.g., for public resources, which avoids burdening
the user with unnecessary authentication work.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/authorizedVerb.html">identityAvailable</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu">.fetch_token_from_cache</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We then set the <code>identityHeader()</code> function, which
generates the HTTP headers containing identity information. In this
case, the test API uses the standard <code>Authorization</code> header
to retrieve the token.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/authorizedVerb.html">identityHeaders</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Authorization<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Bearer"</span>, <span class="fu">.fetch_token_from_cache</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>These headers will now be used in various <em><a href="https://github.com/ArtifactDB/zircon-R" class="external-link">zircon</a></em> functions
to authenticate the user where necessary.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 20.04.5 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3</span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/liblapack.so.3</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] zircon_0.98.0    BiocStyle_2.25.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] knitr_1.40          magrittr_2.0.3      R6_2.5.1           </span></span>
<span><span class="co">##  [4] ragg_1.2.3          rlang_1.0.6         fastmap_1.1.0      </span></span>
<span><span class="co">##  [7] httr_1.4.4          stringr_1.4.1       tools_4.2.1        </span></span>
<span><span class="co">## [10] xfun_0.33           cli_3.4.1           jquerylib_0.1.4    </span></span>
<span><span class="co">## [13] systemfonts_1.0.4   htmltools_0.5.3     yaml_2.3.5         </span></span>
<span><span class="co">## [16] digest_0.6.29       rprojroot_2.0.3     pkgdown_2.0.6      </span></span>
<span><span class="co">## [19] bookdown_0.29       textshaping_0.3.6   BiocManager_1.30.18</span></span>
<span><span class="co">## [22] purrr_0.3.4         sass_0.4.2          fs_1.5.2           </span></span>
<span><span class="co">## [25] curl_4.3.3          memoise_2.0.1       cachem_1.0.6       </span></span>
<span><span class="co">## [28] evaluate_0.16       rmarkdown_2.16      stringi_1.7.8      </span></span>
<span><span class="co">## [31] compiler_4.2.1      bslib_0.4.0         desc_1.4.2         </span></span>
<span><span class="co">## [34] jsonlite_1.8.2</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Lun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
